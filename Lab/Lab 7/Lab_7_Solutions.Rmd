---
title: "Lab 7 Solutions"
author: "Tom Keefe"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Instructions

**Exercises:**  1,4 (Pg. 358); 1,4 (Pgs. 371)

**Assigned:** Friday, November 2, 2018

**Due:** Friday, November 9, 2018 by 5:00 PM

**Submission:** Submit via an electronic document on Sakai. Must be submitted as a HTML file generated in RStudio. All assigned problems are chosen according to the textbook *R for Data Science*. You do not need R code to answer every question. If you answer without using R code, delete the code chunk. If the question requires R code, make sure you display R code. If the question requires a figure, make sure you display a figure. A lot of the questions can be answered in written response, but require R code and/or figures for understanding and explaining.

```{r}
library(tidyverse)
library(modelr)
```


# Chapter 18 (Pg. 358)

##  Exercise 1
```{r}
# Model fitting
loess_model = loess(y ~ x, data=sim1)

# Grid generation
grid = sim1 %>% data_grid(x)

# Add predictions to grid
grid = grid %>% add_predictions(loess_model)

# Visualization
ggplot(sim1, aes(x)) + geom_point(aes(y=y)) + geom_line(aes(y=pred), data=grid, colour="red", size=1)
```

And let's compare to `geom_smooth`:
```{r}
ggplot(sim1, aes(x=x, y=y)) + geom_point() + geom_smooth()
```

`geom_smooth` fits its smooth line using the LOESS method by default (it even says so), so the smooth line is the same. `geom_smooth` also adds a confidence interval for the curve by default.

##  Exercise 4

(Note: absolute residual means absolute value of the residual, raw residual means simply the residual.) 

We might want to look at a frequency polygon (aka histogram) of absolute residuals to visually see how many residuals are a certain distance (i.e. absolute value) from 0. For example, if we wanted to know how many residuals are three units from 0, we would look at the frequency polygon of absolute residuals, look at 3 on the x-axis, and see what count that refers to. If we were using a frequency polygon of raw residuals, we would also have to count the residuals that are at -3 on the x-axis. 

A con of the absolute residual plot is that it throws away the sign of the residual, so we don't get a great sense of where the mean of the residuals is (if it's not a linear model, the mean residual might not be 0), and we don't know if the residuals tend to be negative or positive (skew). These things help us judge whether the model is appropriate for the data. 


# Chapter 18 (Pg. 371)

##  Exercise 1
```{r}
sim2_no_intercept = lm(y ~ x - 1, data=sim2)
grid = sim2 %>% data_grid(x) %>% add_predictions(sim2_no_intercept)
ggplot(sim2, aes(x)) + geom_point(aes(y=y)) + geom_point(data=grid, aes(y=pred), color="red", size=4)
```

The model equation changes by adding a `-1` to the equation, to make clear that the intercept term should not be used. However, we see that the model is exactly the same.

(Note: the reason for this is that because when we predict on one categorical variable, if we have an intercept term, the intercept is used to represent one of the levels of the categories. If we don't include an intercept, we represent that level of the category with something else. Look at the summary of each model to see this.)


##  Exercise 4

Here we plot frequency polygons of the residuals for both models. While the differences are subtle, the residuals for mod2 have slightly tighter spread and more smoothness than the residuals for mod1, which indicate a better fit.

```{r}
mod1 = lm(y ~ x1 + x2, data=sim4)
mod2 = lm(y ~ x1 * x2, data=sim4)

sim4_residuals = sim4 %>% gather_residuals(mod1, mod2)

ggplot(sim4_residuals) + geom_freqpoly(aes(x=resid, color=model), binwidth=0.5)
```


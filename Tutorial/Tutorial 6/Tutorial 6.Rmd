---
title: "STOR 320 Tutorial 6"
author: "Mario Giacomazzo"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: html_document
---

```{r setup, include=FALSE}
# This is a good place to put libraries required for future work
knitr::opts_chunk$set(echo = TRUE)
options(scipen=999)
library(tidyverse)    #Loads the tidyverse suite of packages
library(xtable)       #Alternate to Kable package for printing html tables
```

# Introduction

Baby Mario once had a dream to drop math knowledge on high school students. High schools are evaluated based on student achievement on standardized test scores. The self-proclaimed king, [Lebron James](http://lebronjames.com/), intends to donate $5 million to the district and funds will be distributed according to the improvement of these high schools in the area of mathematics. Because of the king's proclamation, the bureaucratic district heads have pushed high schools to redirect all loose change to mathematics. Teachers of english, science, history, and other subjects have been pressured to dedicate portions of class time to math education. Teachers of music and the arts have been released because the king does not have time for that nonsense. The dreams of these children along with the king's talents have been taken to Hollywood.

The [Cleveland school district](http://www.clevelandmetroschools.org/) is made up of 20 high schools uniquely identified by numbers 1 to 20. Within each high school, a random sample of 20 students are selected to participate in this study and are uniquely identified by numbers 1 to 20. All 400 students selected are assessed on their mathematics skills based on district designed standardized tests in the years 2017 and 2018. The scores and corresponding percentiles of these selected students for both years are simulated in the following R code.

```{r,echo=T}
school.id=rep(1:20,each=20*2)
student.id=rep(rep(1:20,each=2),20)
type=rep(c("Score","Percentile"),20*20)
score2017=round(rnorm(20*20,mean=50,sd=10),0)
percentile2017=round(100*pnorm(score2017,mean=mean(score2017),sd=sd(score2017)),0)
score2018=round(rnorm(20*20,mean=75,sd=4),0)
percentile2018=round(100*pnorm(score2018,mean=mean(score2018),sd=sd(score2018)),0)
value2017=c(rbind(score2017,percentile2017))
value2018=c(rbind(score2018,percentile2018))

untidy.school = tibble(
                  school=school.id,
                  student=student.id,
                  type=type,
                  value2017=value2017,
                  value2018=value2018) %>% 
                filter(!(school==1 & student==4)) %>% filter(!(school==12 & student==18)) %>%
                mutate(value2018=ifelse((school==1 & student==3)|(school==15 & student==18)|
                                          (school==5 & student==12),NA,value2018))
```

Below is an HTML table generated using the `xtable` package in R. For more information regarding this package, see the [xtable gallery](https://cran.r-project.org/web/packages/xtable/vignettes/xtableGallery.pdf). The R code in the code chunk converts an R data frame object to an HTML table. HTML table attributes can be specified within the function `print()`. The code chunk option `echo=F` prevents the code from showing and the option `results="asis"` ensures that the resulting HTML table is displayed when knitted to HTML. The table provides a preview of the first 10 rows of the simulated data.

```{r,echo=F,results="asis"}
tab.untidy.school=untidy.school %>%
                  head(10) %>%
                  xtable(digits=0,align="cccccc")

print(tab.untidy.school,type="html",include.rownames=F,
      html.table.attributes="align='center',
                             rules='rows',
                             width=50%,
                             frame='hsides',
                             border-spacing=5px"
      )
```


Along with the schools' inability to appropriately drop math knowledge on these kids is their inability to record data in a format that is immediately usable. Using our understanding of the `tidyr` package, we can easily convert this table into a form that is useful for data analysis.

# Part 1: Creation of a Unique Student ID

The variable `school` uniquely identifies the school, but the variable `student` only uniquely identifies the student within the school. The problem is best illustrated by the `filter()` function in `dplyr`.

```{r}
untidy.school %>% filter(student==1) %>% head(4)
```

The subsetted table contains scores and percentiles for two completely different children identified by `student==1`. We need to create a unique identifier for each student in the Cleveland school district. The `unite()` function can be utilized to create a new variable called `CID` by concatenating the identifiers for `school` and `student`. We want `CID` to follow the general form *SCHOOL.STUDENT*. Create a new tibble called `untidy2.school` that fixes this problem without dropping the original variables `school` or `student`. Read the documentation for `unite()` either by searching on google or using `?unite` to prevent the loss of original variables in the creation of a new variable. 

```{r,eval=F}
untidy2.school = untidy.school %>%
                    unite(CID,school,student,MORE)
glimpse(untidy2.school)
```

# Part 2: Gather Variables With Yearly Values

The variables `value2017` and `value2018` contain the scores and percentiles for two different years. In a new tibble called `untidy3.school`, based on `untidy2.school`, we want to create a new variable called `Year` and a new variable called `Value` that display the year and the result from that year, respectively. The variable `Year` should be a numeric vector containing either *2017* or *2018*. The most efficient way to modify the data in this manner is to start by renaming `value2017` and `value2018` to nonsynctactic names `2017` and `2018`. Remember that you need to surround nonsyncactic names with backticks to achieve this result. The 

```{r,eval=F}
untidy3.school = untidy2.school %>%
                    rename(NEWVAR=OLDVAR,NEWVAR=OLDVAR) %>%
                    gather(`2017`:`2018`,key=FILL,value=FILL,convert=T)
glimpse(untidy3.school)
```

# Part 3: Spread Type of Value Into Multiple Columns

The variable `type` in `untidy3.school` indicates that two completely different variables are contained in the recently created variable called `Value`. Both the scores and percentiles of students are contained in `Value`. Using the function `spread()` we can create two new variables, `Score` and `Percentile`, that display the information contained in `Value` in separate columns. Using `untidy3.school`, create a new tibble called `tidy.school` that accomplishes these tasks.

```{r,eval=F}
tidy.school = untidy3.school %>%
                    spread(key=FILL,value=FILL) 
glimpse(tidy.school)
```

#Part 4: Missing Data Analysis

The original data contains explicitly missing and implicitly missing values. Instances of both can be visibly seen in the first ten observations. Below is a table showing the first 10 observations in the cleaned dataset we called `tidy.school`.

```{r,echo=F,results="asis",eval=F}
tab.tidy.school = tidy.school %>%
                  head(10) %>%
                  xtable(digits=0,align="ccccccc")

print(tab.tidy.school,type="html",include.rownames=F,
      html.table.attributes="align='center',
                             rules='rows',
                             width=50%,
                             frame='hsides',
                             border-spacing=5px"
      )
```